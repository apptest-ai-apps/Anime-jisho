language: generic
jobs:
  include:
  - stage: build and test
    os: osx
    osx_image: xcode11.3
    before_script:
    - npm install
    - patch -u node_modules/react-native/React/Base/RCTModuleMethod.mm -i fix-xcode-11-build.patch
    script:
    - cd ios; fastlane beta; cd ..
    - git clone https://github.com/apptestai/ci_addon
    - export binary_path="ios/anime_jisho.ipa"
    - export project_id='1102'
    - bash ./ci_addon/step.sh

  - stage: build and test
    os: linux
    language: android
    jdk: oraclejdk8
    android:
      components:
      - tools
      - platform-tools
      - build-tools-29.0.2
      - build-tools-28.0.3
      - android-29
      - android-28
      - android-27
      licenses:
      - android-sdk-license-.+
      - google-gdk-license-.+
    before_script:
    - npm install
    - openssl aes-256-cbc -K $encrypted_64e89481033b_key -iv $encrypted_64e89481033b_iv
      -in keystore.jks.md5.enc -out keystore.jks.md5 -d
    - cat keystore.jks.md5 | base64 --decode > ${HOME}/keystore.jks
    - echo "" >> android/gradle.properties
    - echo "MYAPP_UPLOAD_STORE_FILE=${HOME}/keystore.jks" >> android/gradle.properties
    - echo "MYAPP_UPLOAD_STORE_PASSWORD=${KEY_STORE_PASSWORD}" >> android/gradle.properties
    - echo "MYAPP_UPLOAD_KEY_ALIAS=${ALIAS}" >> android/gradle.properties
    - echo "MYAPP_UPLOAD_KEY_PASSWORD=${KEY_PASSWORD}" >> android/gradle.properties
    script:
    - cd android; ./gradlew assembleRelease; cd ..
    - git clone https://github.com/apptestai/ci_addon
    - export binary_path="android/app/build/outputs/apk/release/app-release.apk"
    - export project_id='1103'
    - bash ./ci_addon/step.sh

env:
  global:
  - secure: DBUnvGf7l/IrkugF+CSSmojVUVYG8QEFMOApshEjB0u5LbrUVRXDzmoeE9WhRMnif2hAZh5yfN18YooPiDU3d4RbNyvtmcrFRlC5tY3TS66bNlliT2YeRP6bJyYcHJjDkDhMIZIEpNLhpui5f2kR36iiKBc/Wm1gyonzHfkoQtX4g2SAimwJbFlt6x/+LglxOQhhP1PGo9FSVshNLHnPUpG+SyFTWBlDp91Ty3SEN/hdMc6P/uoMAqT24JVa8/I8mKmBet4b9v2eb/a51MneRTkxS2PYe3/FBZiT9LV6xzvJiS9VVc9Pb7JrdwLbPb2fLuAt4NfKUlU54SZmcACM2u2XPGntDDtcEvs9cQgjlCELCZ1tm5AWIh+tMIryMKZlKLv9AFd1TVMdKMRMv065iwf9AawhaSlQRrJCYvohKw8GXv1nhgdS2Gk9oDBdEzn6XDitBkwXUZ+0KxzMoo9LlG5vzX4oM5rIVr/QHUqPcz6r7FUfftwgSqbntrxS1I1K5NuPodS8fB40nXRfrCzrsQyRDUEgGsxScAaQ1T+2Rm0knwnLuKghI7j3xR9D1ANvi4X+KFRDy+KB2HkqnPr72BbFjMgMuheLIdqN/OoMrjFq88ur+9mQVMEziY4eLkEhWtFkiYB0CTQETX+lFz1K9J5j712yVKwV0P0XHF/cqgs=
  - secure: P0amNWgpF3BBJUsml8dO8/TzP9OB9egLA1qCk0BYI45uN6F2v/A6oE67Ttjz6q574E0oZducBGhm9YqluPMKMCc7/Pv6s2XrutlXKl+mwjHu6flxWMa4Ox5lmPf03Po8WpuIv/kF+NrDHFAqU5jKwUDhcOgQQ3gdr+YUwBZYYCWtiiMa8uNvISZJEkG/nM/YNe6bH7L2e8A21tHKXf1Nwhe9ADajFVfmkg8ml3SIQPAeP3Gq7K7Sa48FWd+v9KuK7jVgBoCfB08WxhXXbhTVHGJ6PGRbW95AMxtO4qvpXNomUm0qthGMBv2W+PRL8c1aKck5WzJ3kVoY7KEoGDQ95i2Dv7LRQWshgY9k5WhkFh1nnR/DevMZXvPZP9DbVXw7YAY03lja0LJhQoWzE5tPt5ymirFG8m+KzMk74JKVyNWechR6Efb2d4Btk0q4+BENPnuC99Va+d2eQadN4/mavFsp88OCtU3QbfMiTJ27qfhZA4yCsyvSFecPRSRUZk0IutW5OIYlPAmJpzhuPMt8ofr3zO8XTuqs0ttEXDGxbGzAloTFUcSvB9gTkDTlMEXk3nvvmti6cLxy2uhOEyiuEn7B4J0iRaOi+/c7fNpbDPwDlTfErjFwhDvLk8yaTK+hHw3t2NYL7ZW1MfTLKg5hFOBMJccg4xjB/Y6IKaOQQPc=
  - secure: OmepW6uzdtqXQWgdRLmR5jKYtAJemGcsKUmwfpy6ZWlzIsv1bld5ewHyELrsEc7tAXIt1nxCfoydESTHE+853JUsXJ/wqFNZ951SkLfg9aPVdwsBfvn/lZoHHvhSGy/aznTW+k+TgNioVGW+/a7kxyqwKjfJ0mVnfDVcgRZdvLG658SA+99CNu3XMqFIzJegjBTbCsK6l9LuGuLxU6RcqWN7UQabWbKyDxJ7YvrR/qr8fGtmQbpHrcsKf/vV9nCqxhECc3rkLXp8yUrqQqVRjtMlTNM6RaPcoABLOj+eGLWLM0SThRgOtL/71hW/Nv9YqUTLBy3yQ47kFVCseQRY/m9L6vqCGKR6kRB4e44dWTc5iETCJwfscoJ8TpOihYSNC3E0/UsoO0D3H/VwgdUhR6TFzdt+FTp5tyGZYDFMKQu/jcykUvif7jmtBKoCpV9Kvg6BS2lurgFRnVR/GCzTc7wVC0tzI5yax93Y3+LWvRvqQTKpjFv1OAmGfWhG67nmg+Sy5C1IkNzlBzHV1jIhKsXY2cymOW+6TMQ8GeJW8lEOpgvVvmfAZxFqkXypeKlucgrKNGkWMPwDv45AbvVhr2yh6g5+wua1CK2NS9U68NqtF5uausOV89acpd8emLn6XuyXnBvJXEb3NCi78hrYXWIV3FxDBoNEoPKVKVlUh8A=
  - secure: Zb0IZcenVvrt2J4awgGzOw+sfW926kwmIQJgYPQ+ncGiWNZ0dlJ185Snr8tzMhSJlHvqE1+NrVKM9simKptuqC5qkkg28o1n5EBHCIyU57bo3BV0uXP6F2kot9ZXGUlaufK6fXVE02HUwwb//dU2qVPL9cz+yRCi6fiWhAkyd0MgIR+S91EQsmnTDO4iA3jP7XAM9CBANMOa/o3kjuwvDbePNKWUNOmyogHDSBQh7s8qExP8sAVVTzokGrAvMfM5QIv8VtNqT340pUfgT1zAaYbpoGEm9sZ7MutzaOrP/y+Zywhsph4onHjQRlf/LyC9bQGHZVxW6OYHDBJ7QzVNVNAK57BS/LkF+WHkuhlurT65AkJXwCbDBOZisKNkSDuGdxs201GwO2Iv5xkgrXlAfSeYGD+NM1skKYpe/N/27+zZfuf8NfP9afl5cUzmyoCTMlLz7uRbHzMO4i6zutXkDAAGLNbK/7IYO91VZuhYB6ihca8/NW1ZcebQEX3d7/zbKW5pLbWSzpbivqQ5O5uF9WrJtE9Jjw2Fq7SVQtCguZVeglcYt6Ux9LPZaNfav+PmdKvPdxXIm5lzeEmaV4XcVessb300aFaI9hADtY3gdS4mENh81NXow052NRBF+Y7x1MS2SwxxAefyX9YNqx4Oxuqoyqh/jhVVJpETsZfE31Y=
  - secure: JMCRvPQaZA2k7hzFkO7wG1sbwSiQ+VvWDInUqCiO4veXhfPPkSInWlchc0LPV8S2zaTZKnQZrbV3MQ4UvaDhLXbxAVcqd5Un4C8VP8Urnsdp2h9OBatwYG+CYWVHYnYW84nBnW0n+2+cFLyde+7RTP12BV6hP02b8g3IxOqqs/PEqpXzYp0Sw8bz71s3aC0zHJ8G79fJPrvSARXtTsRA2EXr6dvJK5aLo4EQD17iLkKGiYQs9tNxkbBh87CMytMpe/DhaYVOO/1P6BUYBdfdz6Hx75MXttfkaAx96PJufgO8S2+BZ3QC7bGr76XOTqwFW8vKpFtvC2Xw57/mreG+0+z7QWB1EZhmymvYe8XYdfDZCJKg3cMhmP7l3MdiI5m8Ok9wNb2hiE4pS9i1OdC4E/4g1l8o10G7VjeComPkp9zgPYSMaFujs3Pd4lu9Tg9GseAgW1eQ1LQrglwdah/PtsdlWfwtKazp2KCzjG2aOFKPzvQprt+4JUNbCJ/R2mWDEwJ8CP8KteHAsfaYKMAOP5olYFIY5NquQ4tJYIBJdQ7jwaCAWm1vHJBZ1NYhsVm+gZNL2KRvF4ZAXu6WbIAPTRET/uVa2yag8x74wIfdgjCTe3Iiou6WSJIdX1Lx00H2z1UuZz/nRQjCtEoimRqZp2f/l12hqh/eS1kckWo1pzw=
  - secure: aOEFGgHhn4nF3Z6aPJTQmeR1oW42oRPM51+twHYINykkCeiI4qVMEJEZQqp+k9+t3EEJsUXZCa0KDHSze+8oyGvemQRz5LXqhetHC+lEx8wtb8ZTd9t6nagB+fvhCDi7xXAeV9TtySwDuuR4S7d8DZT85QpVv8nfOvcuvFR5iKOZF3n/fYKFng8XeLoFmGtgzjK5nqPyvf/mfetSOkRzuWE4MsFB7iBk9Kt4lGH1Srkv6PWiE6QFnyOkhSaMyqkkRoCR+kEVBJyWJaAajs5iZNMNcf5Do/JKn/mJk4Li2q8XmQnI9AZLuvUZcWTBf80Y0OLySssSWWHG9xjxtDEEUYXvc1D9Ay+dVAMVIFwsLvoYRzb+HvwL6kYYV/5dzf89FNq2TQnzIQe4C0GDgfzaL5iuXusIoK6RJUd29pFByXxQvKXT3/5SpkcT3kHmtNfc2ztgf6ki93bhTC1vtf8ck5BpNRsTR5mAXuIaPzcpU2zcASj86dCnSl8qNAaqwrkml2bp5v5QrKee7ZohSOAmVMLZI8jwFtW5vhIM/Dzy+MDKGAjyvm8KYFb9+kEPMcoRh9iYCpiJdMXgCoEw+H8/eONM9Jp/sEnb0IYBHMaKGzSzYFT0bZ3kcoNSMnY3hfR7wBTY0AEVBZ0Y9m/gVW8veUwf4h6JypnZI+m4IRFKIQ8=
  - secure: eGSfW19NPKApqNbV1CBQPGVpdKWNBDSVJ9lFVr+lTh2kP7NKT7qPsEuz6Qm4pRRDNO0OEdCpll4EysMI9ZfdNepzE478TnhaQWITjLnMDJauyFmlUUKEfBnzg6Wr0MqH5wZcRO64NgB/82QaQ3q3MHV28WigKf2b6qi4MzFV+eyO4ALq36qw3taALCySa/v50gy8U/RwVYFd2fDvGE1QXy/XPh9lQ6vTi5AJGlTJFfyMZsfyq1DdllKRlksX8U5XMPB8UHev1AviwSMx8C5zv1XepYa3GJxd17J73pWzNZI+LR6ijvBfSziOjR3mLg549vc0mBrmhc17UzPQefTLGQk8896oXDxPnpqlVhBgGAX7DXXS+Bcl3THm9vAIO/yqVCVbU1xiHeR8a2pgkJUGXHUjI0Nj5tbwt0I24GS1qR5fKXFD1geDbmJQWPfeXK6N5KtHFsWvisGXP5vHYhUitwxe7N3I8rrPt8VYmwJjvYHk/f3v0tXkMWACjEmYSBswfh0ucbnixyBJ290aLbY/EHUtFOVzcHCkn/fj2DigNEd9iJk/QC7iHrHBIPhkUp2GpG9wY8HNBVDyfXI9prh4C4hmes36gue8g7xkdhCcg4S+cPUAfZYpGq2bTrCYBJOXPBtwa1iyzX7ySNOTtzP8F2R+396oMk8e4E2gcwqCkUE=
  - secure: eoBeOu0jYwhlioYoIk/Ng5v5nbvhzCVnA2nQ3wQGlpB03ad0zIkOlAHOg/wvNRwgMPn0xicufNzIIp03z0otJoIQhKPFKf8NEfaFX9d6RYAQqR0uJvUTpnszwvvF1S3pHIZNI/PSJTNbG56y7cNEttVlWCzBwp86rJWAkyHGrpgsE7xTg5AGNFIKxwDMULw1e4JaKz2Rq5uASjTICOkWJRN2lXA0iv2Q3rttR3++WftutHsmT1aewH7bVBBws7chXq8VUmMwdwgdzRSN1nETCi+ntEQxXrN4cp9I7r8nyVXYbahzcExrEneH+mLWJab+KfFWQZ00GmQAhrw1L/tpMBOIieAMf7JJtPLubjib1zGEfeszC+43uXXYIcRZGPMIx/yKnKJe1R6E36v6LsOK5xSmx9N/AHVWAO+ayDodeJgV3BSmxoSJQJYMSUY4Ugsl0kZGiBBMMtXguK7/3AcqJA0fw8VXo5swDdEVEw+j2SPz9u0MJbr5bzyL0M5f8yi+Tx9wv5ZfEZbALd1owD+nRoPAoGP3YErD4OqxubBrXJORgo3ev1nVdwGX/ETQ6b+g7II2Hi5RBhH1sfoajaipjWL9WZyULNSPv3GXMVILnKvPsiG48tos5nS38fg7zPd7BfujlRK2JFE2jB90KqLPdCUmCJ+tYDPxJTv6yScp+SY=
  - secure: eC/jgj/LflagzfahFp+aVKOi45Ce12Px6rEdVfYdEong8dXjI2RWa2nSmBdl2xUTZ+yQFelTIk3CZf8FsX1iVltd3/TW23yRoI7EUwST4SMEWyiwxxuYmOtkCTtTwNLg78OxEUmi51nHxUPf1vguL/ooJ2YdVKiZqcl3GLl8t3tlFncvJuq960dPd+kFrq4Tmw09dwItwsB2R0irPsUuHUH5/qpTsxFJ9394oXQ11X4/rWry0abgJMB0pQv3WtGFDBE535Y0T8XJ5fjfbnMMabQ6WV+cap+KBQGMR51iwHTCNcsgxQ0iNSzGZuhsw7YckqfL6knIUm7cs+BY6T9f7KrgGn5wKv8IyJxpFRR5J5XmYfO7Br3i3E0OwRzWqeSnTdlyRgoGeezuFOjfr+M/HOLRh+tNGUKtLg1YqEgsvBc5rGVKgjQp3Tej2YASZ87aFBUvL6dNI26FZDsnGnMCLkS9a1MuPDbdULGNirXb0aZkr0HTcBNEfxygg7+9TaupHabQGKd86X8rlns9ccc5L02aiKxjs+Af6nJ5eB2uCpFSe3fJ1x+wUTAcyvk9XkngdMq+EvCZKYkbjwkNsXmm+yFaw9vt0HpYRwYbHZ6F9jLhABG4tt3euq5pMBBqpXoAHXZh2KfR4UN1wU4gI5qruovTDLYcrfDM9D14QQY9LOM=
  - secure: GBB+Hu5cTOa9U9J4yhUwLkjZzl6HrxO2tWS1vY51RPmDLTV3QRzKDVcM1/Kr6O+TSftaxriMvM1/BMGEZpNd6ROguZ8C5H6Xfj21Ck5r4e3KS1U8uGAhEUc3ZsSzrREY9ly7MtBTYJN8L2KB1sVWr5Dakv8r//eP1aE8aN+v9AuyRJ1wCbJyBTljghZCy6Fec57N+MtaL8T6hg1yrpzPQzB4ALdPXPEs6R3kAI4h0cFdk9QA6/mWhiAx2gQpvAyo8yB0LgY5T/dfQU1NKA07Y+s0bpc7Kuk6TyD7DFhEB3GBQJCNbgnlozxULXWd47PJQn0M4724JXJ/7+zuGYBrZHWWsG6sTlYacaPeKdIlgZiGVFcmqmz9JHOdQv6ZoVzxovnWw/hJkucdvwNG6IMZCXzz8/mq1hzVeSx99oVkac0WY9459YEC5LLi/kmSR41E+ky7FZH47LR4QB8tSoSXCgwWqPtsk8QFDsT7ZNArqVjDZb/+OHxPzfZuqLYXiX8KTHoL1TaX7JyD9p1jnziNgkjFX/g7c6km5EP3SIVvD+XmoTfG17IumUpaq7+OJgzBWwmCVRjXLRwkCgSx3nlOcIB0UKy09xw9FpsokwOoXtic6Ao2/1kP5vXEoXXQkC4LGRkX6qTdtK1CZ0TRzM1XUCCRCSz3yIuLDZVJraaZfBQ=
  - secure: dICXO7UXAxzVNo1d9nEnYGMXcsj+bp6Klb+soixPHLEWN+YKPw1EejXArzpOOdCDP7TiN0AwPwtjtAgiC5UHRXCaVFuwQ5U2eFtjQT4fcQoASmPt6JTJWQUzz5L8dKTh1L6tgMf3Bn8XYZTV3VH9fKHIkeHgi5xKnFMn5+SbEQIqueIewpmbQFvfDuzojIwMZIM4Aw167EqCspTNpYBC4nedP2X4xhf3Hflmd6P0z/Pd4L/GuI2iTwCvSFhbPHx/oa/VqEn+74g5tkn9yQnk5+x9NyVZxCQ7W6YPWvwdYyVHt91+6AXSawC3TRWtnOvdBOWOWuP3WzW7zNB2TAQc41HeddVAv2TksAKAxoOwrODAmwdDO5TFJRfZSk9ET50PVq5pGVrTRwbAg3/TiQvAaE3dee64/TeKUZlD9dKr8otZzSexXu0+qNcZakEr0SPyQLEaUSrEodfqMl8p6WrX2KwNEVErhdX1ZJ5Ir6WzEDsC3P8omODNn6EsiCOpyt4NJshb0pFAHU1QFKGXCsgeFcAZdGEA2icxluz4sCiKnWoDm2OBInMAzp4Ysu1UrIrSrf/yysM0GZODZ+tgdeXfCHQykwYas3HlsXXu7e0JPJ06Jb1GgTiNyl6Koa5qe7eWR4mk5i6fLTaD10PdDB40RioIUkxX59iMsnWhX0MXVxo=
  - secure: lSiEe0CUghiJbNk75orFmfw9X+mDBBnP57tsqPV+2yA1dyrS9OQQxlH03r/zhj9ldpYMUMPEgjSBv9r33NdlQsdqn/a4RMoGd3YlvkTGa44OkQadpBfOr7vV4j5SRPgYd2dxDB2BBHzYfXMHpjNFPeUv5b4TwbDoj3uZuN6Qe+Vg98VKIIi9N/uhB5IsAKG7WyN2gkcMVXS3bFaeA3G6KIHlE746scfN14kTCxqhSg4TfYuJQGu432qipdnPOkKwtDoa/AbI4MvSFlWbIMg1FUyhKmePgNT7UHhx22hLZIMf8LOGD3mTKywAr1K0gOdhYk2DMYdNGYmSvmrlvfps6C7U5E/VLch8hVCF3oOUucuWjKgGbBlX8xt/cubNSXisuWAweksIFFsApDKnvDcW2lrsJlIiUWwDn2BbZWM4Gz9tiY0FwtCwbowmGTbYMVrz07r7KT9LlczcDrjPgwhSajcn+XiJHddILyX6jypDHlpFGi43TO8qiDeyfVk6TKm/65+/XY4Pw4iEJlkq6skx8Ma356BBwctUe9ZXrPkK3MPgTABlGEoHNVUAhV+WmFAXLIvQpPqd7+b0FxihEXaUKRiF7/EGEhHBhMZA9Xg4x4HeZRvVl5QSz7bQdsNzqwAq96u9iiGRFoFV09RO0Zf7l4sV54vNh0erWfknJHzRzWA=
